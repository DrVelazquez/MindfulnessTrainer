<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ZenFocus</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Chart.js for graphs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Tailwind Config -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              50: '#f0fdfa', 100: '#ccfbf1', 200: '#99f6e4', 300: '#5eead4',
              400: '#2dd4bf', 500: '#14b8a6', 600: '#0d9488', 700: '#0f766e',
              800: '#115e59', 900: '#134e4a',
            }
          },
          fontFamily: {
            sans: ['Poppins', 'sans-serif'],
          }
        }
      }
    }
  </script>

  <style>
    body { font-family: 'Poppins', sans-serif; user-select: none; -webkit-user-select: none; touch-action: manipulation; }
    
    /* Scrollbar invisible */
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

    /* Animations */
    @keyframes breathe {
      0%, 100% { transform: scale(1) translate(-50%, -50%); opacity: 0.8; }
      50% { transform: scale(1.2) translate(-50%, -50%); opacity: 0.4; }
    }
    .animate-breathe {
      animation: breathe 8s infinite ease-in-out;
      transform-origin: center;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }

    @keyframes bounce-slow {
      0%, 100% { transform: translateY(-5%); }
      50% { transform: translateY(5%); }
    }
    .animate-bounce-slow { animation: bounce-slow 3s infinite ease-in-out; }
    
    @keyframes popIn {
      0% { transform: scale(0.5); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    .animate-pop-in { animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

    .no-tap-highlight { -webkit-tap-highlight-color: transparent; }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.1/",
    "react/": "https://aistudiocdn.com/react@^19.2.1/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.556.0",
    "recharts": "https://aistudiocdn.com/recharts@^3.5.1"
  }
}
</script>
</head>
<body class="bg-slate-50 text-slate-800 antialiased h-screen overflow-hidden flex items-center justify-center sm:p-4">

  <!-- App Container -->
  <div id="app-container" class="w-full max-w-md bg-white/90 backdrop-blur-2xl sm:rounded-[2.5rem] shadow-2xl overflow-hidden h-full sm:h-[90vh] relative border border-white/50 ring-1 ring-black/5 flex flex-col">
    <div id="app-content" class="h-full relative overflow-hidden">
      <!-- Content injected by JS -->
    </div>
  </div>

  <!-- Javascript Logic -->
  <script>
    /** 
     * --- ICONS (SVG Strings) --- 
     */
    const Icons = {
      Play: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>`,
      History: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/><path d="M3 3v9h9"/><path d="M12 7v5l4 2"/></svg>`,
      Award: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>`,
      X: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 18 12"/></svg>`,
      Volume2: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>`,
      VolumeX: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" x2="17" y1="9" y2="15"/><line x1="17" x2="23" y1="9" y2="15"/></svg>`,
      Check: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>`,
      BookOpen: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>`,
      ChevronRight: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>`,
      ChevronLeft: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>`,
      Trash2: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>`,
      Calendar: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>`,
      Pause: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>`
    };

    /** 
     * --- CONSTANTS & DATA --- 
     */
    const SOUNDS = [
      { id: 'silence', label_en: 'Silence', label_es: 'Silencio', url: '' },
      { id: 'ocean', label_en: 'Ocean', label_es: 'OcÃ©ano', url: 'https://cdn.glitch.me/8b472fdc-7a0e-4413-a5c0-df3086ec73d8/ocean.mp3?v=1738588174113' },
      { id: 'rain', label_en: 'Rain', label_es: 'Lluvia', url: 'https://cdn.glitch.me/8b472fdc-7a0e-4413-a5c0-df3086ec73d8/rain.mp3?v=1738588196191' },
      { id: 'music', label_en: 'Music', label_es: 'MÃºsica', url: 'https://cdn.glitch.me/8b472fdc-7a0e-4413-a5c0-df3086ec73d8/music.mp3?v=1738588191326' },
    ];

    const ALARM_URL = "https://cdn.glitch.global/8b472fdc-7a0e-4413-a5c0-df3086ec73d8/alarm.mp3?v=1738962246785";

    const QUOTES = {
      en: [
        "Meditation is not about stopping thoughts, but recognizing them.",
        "Consistency is key. 5 minutes daily is better than 1 hour weekly.",
        "Your mind will wander. That is normal. Bringing it back is the training.",
        "Focus is a muscle. Every time you return to the breath, you do a rep.",
      ],
      es: [
        "La meditaciÃ³n no es detener los pensamientos, sino reconocerlos.",
        "La constancia es clave. 5 minutos diarios es mejor que 1 hora semanal.",
        "Tu mente divagarÃ¡. Es normal. Traerla de vuelta es el entrenamiento.",
        "El enfoque es un mÃºsculo. Cada vez que vuelves, haces una repeticiÃ³n.",
      ]
    };

    const BADGE_DEFINITIONS = [
      { id: 1, title_en: "First Step", title_es: "Primer Paso", icon: "ðŸŒ±", description_en: "Complete your first session.", description_es: "Completa tu primera sesiÃ³n.", condition: (stats) => stats.totalSessions >= 1 },
      { id: 2, title_en: "3-Day Streak", title_es: "Racha 3 DÃ­as", icon: "ðŸ”¥", description_en: "Meditate 3 consecutive days.", description_es: "Medita 3 dÃ­as seguidos.", condition: (stats) => stats.maxStreak >= 3 },
      { id: 3, title_en: "7-Day Streak", title_es: "Racha 7 DÃ­as", icon: "ðŸ—“ï¸", description_en: "Meditate 7 consecutive days.", description_es: "Medita 7 dÃ­as seguidos.", condition: (stats) => stats.maxStreak >= 7 },
      { id: 4, title_en: "15-Day Streak", title_es: "Racha 15 DÃ­as", icon: "ðŸš€", description_en: "Meditate 15 consecutive days.", description_es: "Medita 15 dÃ­as seguidos.", condition: (stats) => stats.maxStreak >= 15 },
      { id: 5, title_en: "30-Day Streak", title_es: "Racha 30 DÃ­as", icon: "ðŸ’Ž", description_en: "Meditate 30 consecutive days.", description_es: "Medita 30 dÃ­as seguidos.", condition: (stats) => stats.maxStreak >= 30 },
      { id: 6, title_en: "Deep Diver", title_es: "Buceador", icon: "ðŸŒŠ", description_en: "One session > 45 mins.", description_es: "Una sesiÃ³n > 45 mins.", condition: (stats) => stats.longMeditationCount >= 1 },
      { id: 7, title_en: "Laser Focus", title_es: "Enfoque LÃ¡ser", icon: "ðŸŽ¯", description_en: "Session with â‰¤ 1 distraction.", description_es: "SesiÃ³n con â‰¤ 1 distracciÃ³n.", condition: (stats) => stats.focusedSessionCount >= 1 },
      { id: 8, title_en: "Silent Mind", title_es: "Mente Silenciosa", icon: "ðŸ¤«", description_en: "Session with 0 distractions.", description_es: "SesiÃ³n sin distracciones.", condition: (stats) => stats.silentSessionCount >= 1 },
      { id: 9, title_en: "Zen Warrior", title_es: "Guerrero Zen", icon: "âš”ï¸", description_en: "5 sessions > 30 mins.", description_es: "5 sesiones > 30 mins.", condition: (stats) => stats.long30Count >= 5 },
      { id: 10, title_en: "Dedicated", title_es: "Dedicado", icon: "ðŸ…", description_en: "Complete 10 sessions.", description_es: "Completa 10 sesiones.", condition: (stats) => stats.totalSessions >= 10 },
      { id: 11, title_en: "Master", title_es: "Maestro", icon: "ðŸ‘‘", description_en: "Complete 50 sessions.", description_es: "Completa 50 sesiones.", condition: (stats) => stats.totalSessions >= 50 },
      { id: 12, title_en: "Marathon", title_es: "MaratÃ³n", icon: "â³", description_en: "300 total minutes.", description_es: "300 minutos totales.", condition: (stats) => stats.totalMinutes >= 300 },
      { id: 13, title_en: "Guru", title_es: "GurÃº", icon: "ðŸ§˜", description_en: "600 total minutes.", description_es: "600 minutos totales.", condition: (stats) => stats.totalMinutes >= 600 },
      { id: 14, title_en: "Enlightened", title_es: "Iluminado", icon: "âœ¨", description_en: "900 total minutes.", description_es: "900 minutos totales.", condition: (stats) => stats.totalMinutes >= 900 },
      { id: 15, title_en: "Iron Will", title_es: "Voluntad de Hierro", icon: "ðŸ¦¾", description_en: "7-day streak of 1 hour sessions.", description_es: "Racha de 7 dÃ­as de 1 hora.", condition: (stats) => stats.hourStreak >= 7 }
    ];

    const LEARN_SLIDES = [
      { icon: "ðŸ‘‹", title_en: "Welcome to ZenFocus", title_es: "Bienvenido a ZenFocus", text_en: "A powerful tool to train your mind and build the habit of meditation.", text_es: "Una herramienta poderosa para entrenar tu mente y formar el hÃ¡bito de meditar." },
      { icon: "ðŸ§ ", title_en: "The Myth", title_es: "El Mito", text_en: "Meditation is NOT about blanking your mind! Itâ€™s about honing your attention.", text_es: "Â¡La meditaciÃ³n NO es poner la mente en blanco! Se trata de afinar tu atenciÃ³n." },
      { icon: "ðŸ˜Œ", title_en: "The Reality", title_es: "La Realidad", text_en: "Your mind will wander. That is completely normal. Don't judge yourself.", text_es: "Tu mente se distraerÃ¡. Eso es totalmente normal. No te juzgues." },
      { icon: "ðŸ’ª", title_en: "The Muscle", title_es: "El MÃºsculo", text_en: "Each time you notice you're distracted and bring your focus back, you do a 'rep'.", text_es: "Cada vez que notas que te distrajiste y vuelves al presente, haces una 'repeticiÃ³n'." },
      { icon: "ðŸ“ˆ", title_en: "Tracking", title_es: "Registro", text_en: "We track distractions to visualize your progress. As your 'muscle' grows, distractions decrease.", text_es: "Contamos las distracciones para visualizar tu progreso. Al crecer tu 'mÃºsculo', bajan." },
      { icon: "â±ï¸", title_en: "Consistency", title_es: "Constancia", text_en: "10 minutes a day is better than 1 hour a week. Small steps transform your life.", text_es: "10 minutos al dÃ­a es mejor que 1 hora a la semana. PequeÃ±os pasos transforman tu vida." }
    ];

    const TRANSLATIONS = {
      en: {
        title: "ZenFocus", subtitle: "Mindfulness Trainer", newSession: "New Session", history: "Journey", achievements: "Badges", learn: "Zen Guide",
        minutes: "minutes", start: "Begin Journey", stop: "Stop", distractions: "Distractions", summary: "Session Complete",
        totalTime: "Total Time", avgInterval: "Focus Interval", backHome: "Return Home", delete: "Delete", reset: "Reset Data",
        confirmReset: "Delete all progress?", level: "Level", points: "Points", tapToDistract: "Tap screen when distracted",
        greatJob: "You are building a powerful habit.", selectSound: "Environment", selectDuration: "Duration",
        resume: "Resume", cancel: "Cancel", confirm: "Confirm", save: "Save Progress", discard: "Discard", paused: "Paused",
        prev: "Prev", next: "Next", finish: "Finish", learnTitle: "How it Works", newBadge: "Badge Unlocked!", awesome: "Awesome!"
      },
      es: {
        title: "ZenFocus", subtitle: "Entrenador Mental", newSession: "Nueva SesiÃ³n", history: "Mi Viaje", achievements: "Insignias", learn: "GuÃ­a Zen",
        minutes: "minutos", start: "Comenzar Viaje", stop: "Parar", distractions: "Distracciones", summary: "SesiÃ³n Completa",
        totalTime: "Tiempo Total", avgInterval: "Intervalo de Foco", backHome: "Volver al Inicio", delete: "Eliminar", reset: "Borrar Datos",
        confirmReset: "Â¿Borrar todo el progreso?", level: "Nivel", points: "Puntos", tapToDistract: "Toca la pantalla si te distraes",
        greatJob: "EstÃ¡s construyendo un hÃ¡bito poderoso.", selectSound: "Ambiente", selectDuration: "DuraciÃ³n",
        resume: "Reanudar", cancel: "Cancelar", confirm: "Confirmar", save: "Guardar Progreso", discard: "Descartar", paused: "Pausado",
        prev: "Ant", next: "Sig", finish: "Finalizar", learnTitle: "CÃ³mo Funciona", newBadge: "Â¡Insignia Desbloqueada!", awesome: "Â¡IncreÃ­ble!"
      }
    };

    /** 
     * --- STATE MANAGEMENT --- 
     */
    const State = {
      view: 'HOME',
      lang: navigator.language.startsWith('es') ? 'es' : 'en',
      duration: 5,
      sound: 'ocean',
      activeSession: {
        timer: null,
        timeLeft: 0,
        distractions: 0,
        timestamps: [],
        paused: false,
        startTime: 0
      },
      learnSlide: 0,
      newUnlockedBadges: [] // Queue for popup
    };

    // References
    const bgAudio = new Audio();
    bgAudio.loop = true;
    const alarmAudio = new Audio(ALARM_URL);
    let wakeLock = null;

    /** 
     * --- LOGIC: STORAGE & STATS --- 
     */
    function getHistory() {
      try { return JSON.parse(localStorage.getItem('zenfocus_history') || '[]'); } catch { return []; }
    }

    function saveSession(session) {
      const history = getHistory();
      history.unshift(session);
      localStorage.setItem('zenfocus_history', JSON.stringify(history));
      return history;
    }

    function clearData() {
      if(confirm(TRANSLATIONS[State.lang].confirmReset)) {
        localStorage.removeItem('zenfocus_history');
        renderHome();
      }
    }

    function calculateStats(history) {
      if (!history.length) return { totalSessions: 0, totalMinutes: 0, maxStreak: 0, points: 0, longMeditationCount: 0, focusedSessionCount: 0, silentSessionCount: 0, long30Count: 0, hourStreak: 0 };
      
      const totalSessions = history.length;
      const totalMinutes = Math.floor(history.reduce((a, b) => a + b.durationSeconds, 0) / 60);
      
      // Points Logic: x10 Multiplier
      const points = Math.floor(history.reduce((acc, curr) => {
        let p = (curr.durationSeconds / 60) * 10;
        if (curr.distractions === 0 && curr.durationSeconds > 300) p += 50; 
        return acc + p;
      }, 0));

      // Advanced Stats
      const longMeditationCount = history.filter(s => s.durationSeconds >= 45 * 60).length;
      const focusedSessionCount = history.filter(s => s.distractions <= 1).length;
      const silentSessionCount = history.filter(s => s.distractions === 0).length;
      const long30Count = history.filter(s => s.durationSeconds >= 30 * 60).length;

      // Streak Logic
      const sortedDates = history.map(s => new Date(s.date).setHours(0,0,0,0)).sort((a,b) => b-a);
      const uniqueDates = Array.from(new Set(sortedDates));
      let maxStreak = uniqueDates.length > 0 ? 1 : 0;
      let tempStreak = 1;
      for(let i=0; i<uniqueDates.length-1; i++){
        if(uniqueDates[i] - uniqueDates[i+1] === 86400000) tempStreak++;
        else tempStreak = 1;
        if(tempStreak > maxStreak) maxStreak = tempStreak;
      }
      
      // Hour Streak Logic (Simplified for brevity)
      const hourDates = history.filter(s => s.durationSeconds >= 3600).map(s => new Date(s.date).setHours(0,0,0,0)).sort((a,b) => b-a);
      const uniqueHourDates = Array.from(new Set(hourDates));
      let hourStreak = uniqueHourDates.length > 0 ? 1 : 0;
      let tempH = 1;
      for(let i=0; i<uniqueHourDates.length-1; i++){
        if(uniqueHourDates[i] - uniqueHourDates[i+1] === 86400000) tempH++;
        else tempH = 1;
        if(tempH > hourStreak) hourStreak = tempH;
      }
      
      return { totalSessions, totalMinutes, maxStreak, points, longMeditationCount, focusedSessionCount, silentSessionCount, long30Count, hourStreak };
    }

    function getLevel(points) {
      const levels = [
        { min: 0, en: 'Novice', es: 'Novato' },
        { min: 1000, en: 'Seeker', es: 'Buscador' },
        { min: 4000, en: 'Initiate', es: 'Iniciado' },
        { min: 8000, en: 'Adept', es: 'Adepto' },
        { min: 15000, en: 'Master', es: 'Maestro' },
        { min: 30000, en: 'Sage', es: 'Sabio' },
        { min: 60000, en: 'Zen Master', es: 'Maestro Zen' },
        { min: 100000, en: 'Buddha', es: 'Buda' }
      ];
      let lvl = levels[0];
      let nextLvl = levels[1];
      for(let i=levels.length-1; i>=0; i--) {
        if(points >= levels[i].min) {
          lvl = levels[i];
          nextLvl = levels[i+1] || { min: points * 1.5 }; 
          break;
        }
      }
      const title = State.lang === 'es' ? lvl.es : lvl.en;
      const progress = Math.min(100, ((points - lvl.min) / (nextLvl.min - lvl.min)) * 100);
      return { title, progress, points };
    }

    /** 
     * --- RENDERING FUNCTIONS --- 
     */
    const app = document.getElementById('app-content');

    function navigate(view) {
      State.view = view;
      if (view === 'HOME') renderHome();
      else if (view === 'SETUP') renderSetup();
      else if (view === 'ACTIVE') renderActive();
      else if (view === 'SUMMARY') renderSummary();
      else if (view === 'HISTORY') renderHistory();
      else if (view === 'BADGES') renderBadges();
      else if (view === 'LEARN') renderLearn();
      else if (view === 'BADGE_POPUP') renderBadgePopup();
    }

    function toggleLang() {
      State.lang = State.lang === 'en' ? 'es' : 'en';
      navigate(State.view);
    }

    // --- HOME ---
    function renderHome() {
      const stats = calculateStats(getHistory());
      const level = getLevel(stats.points);
      const t = TRANSLATIONS[State.lang];
      const quote = QUOTES[State.lang][Math.floor(Math.random() * QUOTES[State.lang].length)];

      app.innerHTML = `
        <div class="flex flex-col h-full space-y-5 p-6 animate-fade-in overflow-y-auto scrollbar-hide">
          <!-- Header -->
          <div class="flex justify-between items-center pt-2">
            <div>
              <h1 class="text-3xl font-bold text-slate-800">${t.title}</h1>
              <p class="text-sm text-brand-600 font-medium tracking-wide">${t.subtitle}</p>
            </div>
            <button onclick="toggleLang()" class="text-xs font-bold px-3 py-1 bg-white border border-slate-200 rounded-full shadow-sm text-slate-600 hover:bg-slate-50 transition">
              ${State.lang === 'en' ? 'ES' : 'EN'}
            </button>
          </div>

          <!-- Level Card -->
          <div class="bg-gradient-to-r from-brand-600 to-brand-500 rounded-3xl p-6 text-white shadow-xl shadow-brand-200 relative overflow-hidden shrink-0">
            <div class="absolute top-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full -mr-10 -mt-10 blur-2xl"></div>
            <div class="flex justify-between items-end mb-4 relative z-10">
              <div>
                <p class="text-brand-100 text-xs font-bold uppercase tracking-widest">${t.level}</p>
                <h2 class="text-3xl font-bold mt-1">${level.title}</h2>
              </div>
              <div class="text-right">
                <span class="text-2xl font-bold">${level.points}</span>
                <span class="text-xs text-brand-100 block opacity-80">${t.points}</span>
              </div>
            </div>
            <div class="w-full bg-black/20 rounded-full h-1.5 mb-1 relative z-10 overflow-hidden">
              <div class="bg-white rounded-full h-1.5 transition-all duration-1000" style="width: ${level.progress}%"></div>
            </div>
          </div>

          <!-- Quote -->
          <div class="bg-white/80 backdrop-blur p-5 rounded-2xl border border-white shadow-sm shrink-0">
            <p class="text-slate-600 italic text-center text-sm leading-relaxed">"${quote}"</p>
          </div>

          <!-- Learn Button -->
          <button onclick="startLearn()" class="bg-blue-50 hover:bg-blue-100 transition-colors p-4 rounded-2xl flex items-center gap-4 group shrink-0">
            <div class="bg-white p-2 rounded-full shadow-sm text-blue-500 group-hover:scale-110 transition-transform">
              ${Icons.BookOpen}
            </div>
            <div class="text-left flex-1">
               <h3 class="font-bold text-slate-800 text-sm">${t.learn}</h3>
               <p class="text-xs text-slate-500">${t.learnTitle}</p>
            </div>
            <div class="text-slate-400">${Icons.ChevronRight}</div>
          </button>

          <!-- Main Actions -->
          <div class="mt-auto space-y-3 pb-2">
            <button onclick="navigate('SETUP')" class="w-full py-4 px-6 rounded-2xl font-semibold bg-brand-600 text-white shadow-lg shadow-brand-200 hover:bg-brand-700 active:scale-95 flex items-center justify-center gap-2 text-lg">
              ${Icons.Play} ${t.newSession}
            </button>
            <div class="grid grid-cols-2 gap-3">
              <button onclick="navigate('HISTORY')" class="py-3 px-6 rounded-2xl font-semibold bg-white text-slate-700 border border-slate-200 shadow-sm hover:border-brand-300 hover:text-brand-600 active:scale-95 flex items-center justify-center gap-2">
                ${Icons.History} ${t.history}
              </button>
              <button onclick="navigate('BADGES')" class="py-3 px-6 rounded-2xl font-semibold bg-white text-slate-700 border border-slate-200 shadow-sm hover:border-brand-300 hover:text-brand-600 active:scale-95 flex items-center justify-center gap-2">
                ${Icons.Award} ${t.achievements}
              </button>
            </div>
          </div>
        </div>
      `;
    }

    // --- SETUP ---
    function renderSetup() {
      const t = TRANSLATIONS[State.lang];
      app.innerHTML = `
        <div class="flex flex-col h-full relative">
          <div class="flex items-center p-6 pb-2 shrink-0">
            <button onclick="navigate('HOME')" class="p-2 -ml-2 text-slate-400 hover:text-slate-600">${Icons.X}</button>
            <h2 class="text-xl font-bold ml-2 text-slate-800">${t.newSession}</h2>
          </div>

          <div class="flex-1 overflow-y-auto px-6 pb-24 scrollbar-hide">
            <!-- Duration -->
            <div class="mb-8 mt-2">
              <label class="block text-slate-500 text-sm font-bold uppercase tracking-wider mb-4">${t.selectDuration}</label>
              <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100 text-center relative overflow-hidden">
                 <div class="absolute top-0 left-0 w-full h-2 bg-brand-500"></div>
                 <div class="flex items-baseline justify-center gap-2">
                    <span id="duration-display" class="text-6xl font-bold text-slate-800">${State.duration}</span>
                    <span class="text-slate-400 font-medium text-lg">${t.minutes}</span>
                 </div>
                <input type="range" min="1" max="60" value="${State.duration}" 
                  class="w-full mt-8 h-3 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-brand-500"
                  oninput="updateDuration(this.value)">
                <div class="flex justify-between text-xs text-slate-400 mt-2 font-medium">
                  <span>1m</span><span>30m</span><span>60m</span>
                </div>
              </div>
            </div>

            <!-- Sound -->
            <div class="mb-4">
              <label class="block text-slate-500 text-sm font-bold uppercase tracking-wider mb-4">${t.selectSound}</label>
              <div class="grid grid-cols-2 gap-3" id="sound-grid">
                <!-- Sounds injected here -->
              </div>
            </div>
          </div>

          <!-- Fixed Start Button -->
          <div class="absolute bottom-0 left-0 w-full bg-white/80 backdrop-blur-md p-6 border-t border-white">
            <button onclick="startSession()" class="w-full py-3 px-6 rounded-2xl font-semibold bg-brand-600 text-white shadow-xl shadow-brand-200 hover:bg-brand-700 active:scale-95 flex items-center justify-center gap-2">
              ${t.start}
            </button>
          </div>
        </div>
      `;
      renderSounds();
    }

    function updateDuration(val) {
      State.duration = parseInt(val);
      document.getElementById('duration-display').innerText = val;
    }

    function renderSounds() {
      const grid = document.getElementById('sound-grid');
      grid.innerHTML = SOUNDS.map(s => {
        const isSelected = State.sound === s.id;
        const label = State.lang === 'es' ? s.label_es : s.label_en;
        return `
          <button onclick="selectSound('${s.id}')" 
            class="p-4 rounded-2xl border-2 transition-all flex flex-col items-center justify-center gap-2 relative overflow-hidden
            ${isSelected ? 'border-brand-500 bg-brand-50 text-brand-700 shadow-md' : 'border-transparent bg-white text-slate-400 hover:bg-slate-50'}">
            ${isSelected ? '<div class="absolute top-2 right-2 w-2 h-2 bg-brand-500 rounded-full"></div>' : ''}
            <div class="${isSelected ? '' : 'opacity-70'}">${isSelected ? Icons.Volume2 : Icons.VolumeX}</div>
            <span class="text-sm font-semibold">${label}</span>
          </button>
        `;
      }).join('');
    }

    function selectSound(id) {
      State.sound = id;
      renderSounds();
    }

    // --- ACTIVE SESSION ---
    async function startSession() {
      // Audio Setup
      const soundObj = SOUNDS.find(s => s.id === State.sound);
      if(soundObj && soundObj.url) {
        bgAudio.src = soundObj.url;
        bgAudio.play().catch(e => console.log(e));
      } else {
        bgAudio.pause();
      }

      // Wake Lock
      if ('wakeLock' in navigator) {
        try { wakeLock = await navigator.wakeLock.request('screen'); } catch(e){}
      }

      // Init State
      State.activeSession = {
        timeLeft: State.duration * 60,
        distractions: 0,
        timestamps: [Date.now()],
        paused: false,
        startTime: Date.now()
      };

      navigate('ACTIVE');
      startTimer();
    }

    function startTimer() {
      if(State.activeSession.timer) clearInterval(State.activeSession.timer);
      State.activeSession.timer = setInterval(() => {
        if(!State.activeSession.paused) {
          State.activeSession.timeLeft--;
          updateTimerDisplay();
          if(State.activeSession.timeLeft <= 0) {
            finishSession(true);
          }
        }
      }, 1000);
    }

    function updateTimerDisplay() {
      const m = Math.floor(State.activeSession.timeLeft / 60);
      const s = State.activeSession.timeLeft % 60;
      const timeStr = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
      const el = document.getElementById('timer-display');
      if(el) el.innerText = timeStr;
    }

    function recordDistraction() {
      if(State.activeSession.paused) return;
      State.activeSession.distractions++;
      State.activeSession.timestamps.push(Date.now());
      
      // Update UI Text
      const t = TRANSLATIONS[State.lang];
      const distEl = document.getElementById('distraction-text');
      if(distEl) distEl.innerText = `${State.activeSession.distractions} ${t.distractions}`;

      // Ripple Effect
      const container = document.getElementById('active-container');
      const ripple = document.createElement('div');
      ripple.className = "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full bg-red-500/10 rounded-full animate-ping pointer-events-none";
      container.appendChild(ripple);
      setTimeout(() => ripple.remove(), 600);
    }

    function togglePause() {
      State.activeSession.paused = !State.activeSession.paused;
      const menu = document.getElementById('pause-menu');
      if(State.activeSession.paused) {
        menu.classList.remove('hidden');
        bgAudio.pause();
      } else {
        menu.classList.add('hidden');
        if(SOUNDS.find(s => s.id === State.sound).url) bgAudio.play();
      }
    }

    function discardSession() {
      clearInterval(State.activeSession.timer);
      bgAudio.pause();
      if(wakeLock) wakeLock.release();
      navigate('HOME');
    }

    function finishSession(completed) {
      clearInterval(State.activeSession.timer);
      bgAudio.pause();
      if(wakeLock) wakeLock.release();
      
      if(completed) {
        alarmAudio.currentTime = 0;
        alarmAudio.play().catch(e=>console.log(e));
        // Stop alarm after 4 seconds
        setTimeout(() => {
          alarmAudio.pause();
          alarmAudio.currentTime = 0;
        }, 4000);
      }

      // Calculate Data
      const totalDuration = (State.duration * 60) - State.activeSession.timeLeft;
      
      // Calc Avg Interval
      const timestamps = [...State.activeSession.timestamps, Date.now()];
      let avg = totalDuration;
      if(timestamps.length > 2) {
        let totalInt = 0;
        for(let i=1; i<timestamps.length; i++) totalInt += (timestamps[i] - timestamps[i-1]);
        avg = Math.floor((totalInt / (timestamps.length-1)) / 1000);
      }

      const sessionData = {
        id: Date.now(),
        date: new Date().toISOString(),
        durationSeconds: completed ? State.duration * 60 : totalDuration,
        distractions: State.activeSession.distractions,
        avgIntervalSeconds: avg
      };

      // CHECK BADGES BEFORE SAVING
      const prevHistory = getHistory();
      const prevStats = calculateStats(prevHistory);
      
      saveSession(sessionData);
      
      const newHistory = getHistory();
      const newStats = calculateStats(newHistory);
      
      State.lastSession = sessionData; // temp store for summary
      
      // Find new unlocked badges
      const newBadges = BADGE_DEFINITIONS.filter(b => !b.condition(prevStats) && b.condition(newStats));
      
      if(newBadges.length > 0) {
        State.newUnlockedBadges = newBadges;
        navigate('BADGE_POPUP');
      } else {
        navigate('SUMMARY');
      }
    }

    function renderActive() {
      const t = TRANSLATIONS[State.lang];
      app.innerHTML = `
        <div id="active-container" class="w-full h-full bg-brand-50 relative overflow-hidden flex flex-col items-center justify-center z-0" onclick="recordDistraction()">
          
          <!-- Stop Button (Top Right) -->
          <button onclick="event.stopPropagation(); togglePause()" class="absolute top-6 right-6 z-50 p-3 bg-white/50 backdrop-blur rounded-full text-slate-600 hover:bg-white hover:text-red-500 shadow-sm transition-all">
            ${Icons.Pause}
          </button>

          <!-- Breathing Visual -->
          <div class="absolute top-1/2 left-1/2 w-80 h-80 bg-brand-200 rounded-full blur-[80px] opacity-40 animate-breathe pointer-events-none"></div>

          <!-- Timer & Counter -->
          <div class="relative z-10 text-center pointer-events-none select-none">
            <div id="timer-display" class="text-[5rem] leading-none font-light text-brand-900 tracking-tight font-mono mb-6 drop-shadow-sm">
              ${String(State.duration).padStart(2,'0')}:00
            </div>
            <p id="distraction-text" class="text-brand-800/60 text-sm font-bold uppercase tracking-[0.2em] mb-8">
              ${t.tapToDistract}
            </p>
          </div>

          <!-- Pause Menu Overlay -->
          <div id="pause-menu" class="hidden absolute inset-0 z-50 bg-white/90 backdrop-blur-md flex flex-col items-center justify-center p-8 animate-fade-in" onclick="event.stopPropagation()">
            <h2 class="text-2xl font-bold text-slate-800 mb-2">${t.paused}</h2>
            <div class="flex flex-col gap-3 w-full max-w-xs mt-6">
              <button onclick="togglePause()" class="py-3 rounded-xl bg-brand-600 text-white font-semibold shadow-lg shadow-brand-200 hover:bg-brand-700">
                ${t.resume}
              </button>
              <button onclick="finishSession(false)" class="py-3 rounded-xl bg-white border border-slate-200 text-slate-700 font-semibold hover:bg-slate-50">
                ${t.save}
              </button>
              <button onclick="discardSession()" class="py-3 rounded-xl bg-red-50 text-red-500 border border-red-100 font-semibold hover:bg-red-100">
                ${t.discard}
              </button>
            </div>
          </div>

        </div>
      `;
    }

    // --- BADGE POPUP ---
    function renderBadgePopup() {
      const badge = State.newUnlockedBadges[0];
      const t = TRANSLATIONS[State.lang];
      const title = State.lang === 'es' ? badge.title_es : badge.title_en;
      const desc = State.lang === 'es' ? badge.description_es : badge.description_en;

      app.innerHTML = `
        <div class="flex flex-col h-full items-center justify-center p-6 bg-brand-600 animate-pop-in text-white text-center relative overflow-hidden">
           <!-- Particles background (simulated) -->
           <div class="absolute inset-0 opacity-20 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCI+PGNpcmNsZSBjeD0iMTAiIGN5PSIxMCIgcj0iMiIgZmlsbD0id2hpdGUiLz48L3N2Zz4=')]"></div>

           <div class="text-8xl mb-6 animate-bounce-slow relative z-10">${badge.icon}</div>
           <h2 class="text-3xl font-bold mb-2 relative z-10">${t.newBadge}</h2>
           <div class="bg-white/10 p-6 rounded-3xl backdrop-blur-sm border border-white/20 mb-8 relative z-10">
             <h3 class="text-2xl font-bold text-white mb-2">${title}</h3>
             <p class="text-brand-100 text-lg">${desc}</p>
           </div>
           
           <button onclick="closeBadgePopup()" class="w-full py-4 rounded-2xl font-bold bg-white text-brand-600 shadow-xl hover:bg-brand-50 relative z-10">
             ${t.awesome}
           </button>
        </div>
      `;
    }

    function closeBadgePopup() {
      State.newUnlockedBadges.shift(); // Remove first
      if (State.newUnlockedBadges.length > 0) {
        renderBadgePopup(); // Show next
      } else {
        navigate('SUMMARY');
      }
    }

    // --- SUMMARY ---
    function renderSummary() {
      const session = State.lastSession;
      const t = TRANSLATIONS[State.lang];
      
      app.innerHTML = `
        <div class="flex flex-col h-full animate-fade-in justify-center p-6">
          <div class="text-center py-6">
            <div class="inline-flex p-5 bg-gradient-to-br from-green-100 to-green-200 text-green-600 rounded-full mb-6 shadow-sm ring-4 ring-green-50">
              ${Icons.Check}
            </div>
            <h2 class="text-3xl font-bold text-slate-800 mb-2">${t.summary}</h2>
            <p class="text-slate-500 max-w-[200px] mx-auto leading-tight">${t.greatJob}</p>
          </div>

          <div class="bg-white rounded-[2rem] p-6 shadow-xl shadow-slate-100 border border-slate-50 mb-8">
            <div class="grid grid-cols-2 gap-8 mb-6">
              <div class="text-center">
                <p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider mb-1">${t.totalTime}</p>
                <p class="text-2xl font-bold text-slate-700">${Math.floor(session.durationSeconds / 60)}<span class="text-sm text-slate-400 font-normal">m</span></p>
              </div>
              <div class="text-center relative">
                <div class="absolute left-0 top-2 bottom-2 w-px bg-slate-100"></div>
                <p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider mb-1">${t.distractions}</p>
                <p class="text-2xl font-bold text-slate-700">${session.distractions}</p>
              </div>
            </div>
            <div class="bg-brand-50 rounded-2xl p-4 text-center border border-brand-100">
              <p class="text-[10px] text-brand-400 uppercase font-bold tracking-wider mb-1">${t.avgInterval}</p>
              <p class="text-3xl font-bold text-brand-700">${session.avgIntervalSeconds} <span class="text-sm font-normal opacity-60">sec</span></p>
            </div>
          </div>

          <button onclick="navigate('HOME')" class="mt-auto w-full py-4 px-6 rounded-2xl font-semibold bg-brand-600 text-white shadow-lg shadow-brand-200 hover:bg-brand-700 transition-all">
            ${t.backHome}
          </button>
        </div>
      `;
    }

    // --- HISTORY ---
    function renderHistory() {
      const t = TRANSLATIONS[State.lang];
      const history = getHistory();

      app.innerHTML = `
        <div class="flex flex-col h-full p-6">
           <div class="flex items-center mb-6 shrink-0">
            <button onclick="navigate('HOME')" class="p-2 -ml-2 text-slate-400 hover:text-slate-600">${Icons.X}</button>
            <h2 class="text-xl font-bold ml-2 text-slate-800">${t.history}</h2>
          </div>

          <!-- Chart Container (Last 50 sessions) -->
          <div class="bg-white p-4 rounded-3xl shadow-sm border border-slate-100 mb-6 h-48 w-full shrink-0 relative">
             <canvas id="historyChart"></canvas>
          </div>

          <!-- List (Last 5 sessions) -->
          <div class="flex-1 overflow-y-auto -mx-6 px-6 pb-4 space-y-4 scrollbar-hide">
            ${history.length === 0 ? `<div class="text-center py-10 opacity-50"><div class="mx-auto mb-2 text-slate-300 w-12 h-12 flex justify-center">${Icons.Calendar}</div><p>No sessions yet.</p></div>` : ''}
            
            ${history.slice(0, 5).map((h, i) => {
              const isGood = h.avgIntervalSeconds > 60;
              return `
                <div class="bg-white p-4 rounded-2xl border border-slate-50 shadow-sm flex flex-col gap-2 relative overflow-hidden group">
                  <div class="absolute left-0 top-0 bottom-0 w-1 ${isGood ? 'bg-brand-400' : 'bg-orange-300'}"></div>
                  <div class="flex justify-between items-start pl-3">
                    <div>
                      <p class="text-xs font-bold text-slate-400 uppercase tracking-wide">${new Date(h.date).toLocaleDateString()}</p>
                      <p class="text-lg font-bold text-slate-700 mt-0.5">${Math.floor(h.durationSeconds / 60)} <span class="text-sm font-normal text-slate-500">mins</span></p>
                    </div>
                    <div class="text-right">
                      <p class="text-xl font-bold ${isGood ? 'text-brand-600' : 'text-orange-400'}">${h.avgIntervalSeconds}s</p>
                      <p class="text-[10px] text-slate-400 font-bold uppercase">Focus Interval</p>
                    </div>
                  </div>
                  <div class="flex items-center gap-2 pl-3 mt-1 pt-2 border-t border-slate-50">
                     <span class="text-xs text-slate-500 bg-slate-50 px-2 py-1 rounded-md">${h.distractions} distractions</span>
                  </div>
                </div>
              `;
            }).join('')}
            
            ${history.length > 0 ? `<button onclick="clearData()" class="w-full text-xs text-red-400 py-4 flex items-center justify-center gap-2 hover:text-red-600">${Icons.Trash2} ${t.reset}</button>` : ''}
          </div>
        </div>
      `;

      if(history.length > 0) {
        // Draw Chart.js
        const ctx = document.getElementById('historyChart').getContext('2d');
        // Chart shows last 50 for trends
        const dataPoints = history.slice(0, 50).reverse(); 
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: dataPoints.map((_, i) => i + 1),
            datasets: [{
              label: 'Focus Interval',
              data: dataPoints.map(d => d.avgIntervalSeconds),
              borderColor: '#0d9488',
              backgroundColor: '#ccfbf1',
              tension: 0.4,
              pointRadius: 3,
              pointBackgroundColor: '#0d9488',
              borderWidth: 2,
              fill: {
                target: 'origin',
                above: 'rgba(13, 148, 136, 0.1)' 
              }
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
              x: { display: false },
              y: { display: false, min: 0 }
            },
            layout: { padding: 5 }
          }
        });
      }
    }

    // --- BADGES ---
    function renderBadges() {
      const t = TRANSLATIONS[State.lang];
      const stats = calculateStats(getHistory());

      app.innerHTML = `
        <div class="flex flex-col h-full p-6">
           <div class="flex items-center mb-6 shrink-0">
            <button onclick="navigate('HOME')" class="p-2 -ml-2 text-slate-400 hover:text-slate-600">${Icons.X}</button>
            <h2 class="text-xl font-bold ml-2 text-slate-800">${t.achievements}</h2>
          </div>

          <div class="grid grid-cols-2 gap-3 overflow-y-auto pb-6 scrollbar-hide -mx-2 px-2">
            ${BADGE_DEFINITIONS.map(b => {
              const unlocked = b.condition(stats);
              return `
                <div class="p-4 rounded-2xl border text-center transition-all relative overflow-hidden group flex flex-col items-center justify-center min-h-[150px]
                  ${unlocked ? 'bg-white border-brand-100 shadow-sm' : 'bg-slate-50 border-transparent'}">
                  ${!unlocked ? '<div class="absolute inset-0 bg-white/40 backdrop-blur-[1px] z-10"></div>' : '<div class="absolute top-2 right-2 w-2 h-2 bg-yellow-400 rounded-full animate-pulse"></div>'}
                  <div class="text-4xl mb-3 ${unlocked ? '' : 'grayscale opacity-50'}">${b.icon}</div>
                  <h3 class="font-bold text-sm mb-1 leading-tight ${unlocked ? 'text-slate-800' : 'text-slate-400'}">${State.lang==='es'?b.title_es:b.title_en}</h3>
                  <p class="text-[10px] text-slate-500 leading-tight px-1">${State.lang==='es'?b.description_es:b.description_en}</p>
                </div>
              `;
            }).join('')}
          </div>
        </div>
      `;
    }

    // --- LEARN ---
    function startLearn() {
      State.learnSlide = 0;
      navigate('LEARN');
    }

    function moveSlide(dir) {
      State.learnSlide += dir;
      renderLearn();
    }

    function renderLearn() {
      const slide = LEARN_SLIDES[State.learnSlide];
      const total = LEARN_SLIDES.length;
      const t = TRANSLATIONS[State.lang];

      app.innerHTML = `
        <div class="flex flex-col h-full relative p-6">
          <button onclick="navigate('HOME')" class="absolute top-4 right-4 p-2 text-slate-400 hover:text-slate-600 z-10">${Icons.X}</button>
          
          <div class="flex-1 flex flex-col justify-center items-center text-center animate-fade-in">
            <div class="text-6xl mb-6 animate-bounce-slow">${slide.icon}</div>
            <h2 class="text-2xl font-bold text-slate-800 mb-4">${State.lang === 'es' ? slide.title_es : slide.title_en}</h2>
            <p class="text-slate-600 text-lg leading-relaxed">${State.lang === 'es' ? slide.text_es : slide.text_en}</p>
          </div>

          <div class="mt-auto">
            <div class="flex justify-center gap-2 mb-6">
              ${LEARN_SLIDES.map((_, i) => `<div class="h-1.5 rounded-full transition-all duration-300 ${i === State.learnSlide ? 'w-6 bg-brand-500' : 'w-1.5 bg-slate-200'}"></div>`).join('')}
            </div>
            <div class="flex justify-between gap-4">
              <button onclick="moveSlide(-1)" class="flex-1 py-3 px-4 rounded-xl font-semibold text-slate-500 hover:bg-slate-50 flex items-center justify-center gap-2 ${State.learnSlide === 0 ? 'invisible' : ''}">
                ${Icons.ChevronLeft} ${t.prev}
              </button>
              
              <button onclick="${State.learnSlide === total - 1 ? "navigate('HOME')" : "moveSlide(1)"}" class="flex-1 py-3 px-4 rounded-xl font-semibold bg-brand-600 text-white shadow-lg hover:bg-brand-700 flex items-center justify-center gap-2">
                ${State.learnSlide === total - 1 ? t.finish : t.next} ${State.learnSlide < total - 1 ? Icons.ChevronRight : ''}
              </button>
            </div>
          </div>
        </div>
      `;
    }

    // Init
    renderHome();

  </script>
</body>
</html>
